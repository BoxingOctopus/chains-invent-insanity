{% extends "base.html" %}
{% block body %}
    <div class="well well-sm">
        <canvas id="card" width="230" height="320">
            {% for card in request.form['num_cards'] %}
                <script language="JavaScript">
                    function wrapText(context, text, x, y, maxWidth, lineHeight) {
                        var words = text.split(' ');
                        var line = '';

                        for(var n = 0; n < words.length; n++){
                            var testLine = line + words[n] + ' ';
                            var metrics = context.measureText(testLine);
                            var testWidth = metrics.width;
                            if (testWidth > maxWidth && n > 0) {
                                context.fillText(line, x, y);
                                line = words[n] + ' ';
                                y += lineHeight;
                            }
                            else {
                                line = testLine;
                            }
                        }
                        context.fillText(line, x, y);
                    }

                    var canvas = document.getElementById("card");

                    canvas.width = 230;
                    canvas.height = 320;

                    var background = new Image();
                    background.src = "https://s3.amazonaws.com/chains-invent-insanity/CAH-blank-white.png";

                    var context = canvas.getContext("2d");

                    background.onload = function() {
                        context.drawImage(background, 0, 0)
                    };

                    var maxWidth = 205;
                    var lineHeight = 25;
                    var x = (canvas.width - maxWidth) / 2;
                    var y = 30;
                    var text = "{{ invent(attempts, num_cards) }}";
                    context.font = "bold 16px Helvetica";
                    wrapText(context, text, x, y, maxWidth, lineHeight);
                </script>
            {% endfor %}
        </canvas>
    </div>
{% endblock %}