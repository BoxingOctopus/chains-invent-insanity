{% extends "base.html" %}
{% block body %}
<div class="row">
    <div class="col-sm-3">
        <canvas id="card">
            <script language="JavaScript">

                function wrapText(context, text, x, y, maxWidth, lineHeight) {
                    var words = text.split(' ');
                    var line = '';

                    for(var n = 0; n < words.length; n++){
                        var testLine = line + words[n] + ' ';
                        var metrics = context.measureText(testLine);
                        var testWidth = metrics.width;
                        if (testWidth > maxWidth && n > 0) {
                            context.fillText(line, x, y);
                            line = words[n] + ' ';
                            y += lineHeight;
                        }
                        else {
                            line = testLine;
                        }
                    }
                    context.fillText(line, x, y);
                }

                var canvas = document.getElementById("card");

                canvas.width = 225;
                canvas.height = 315;
                canvas.style.width = "225px";
                canvas.style.height = "315px";
                canvas.style.backgroundColor = "white";

                var background = new Image();
                background.src = "https://s3.amazonaws.com/chains-invent-insanity/CAH-blank-white.png";

                var context = canvas.getContext("2d");

                roundRect(context, 0, 0, 225, 315, 22);
                context.fillStyle = "rgb(0,0,0)";
                context.strokeStyle = "rgb(0,0,0)";

                function roundRect(context, x, y, width, height, radius, fill, stroke) {
                  if (typeof stroke == 'undefined') {
                    stroke = true;
                  }
                  if (typeof radius === 'undefined') {
                    radius = 5;
                  }
                  if (typeof radius === 'number') {
                    radius = {tl: radius, tr: radius, br: radius, bl: radius};
                  } else {
                    var defaultRadius = {tl: 0, tr: 0, br: 0, bl: 0};
                    for (var side in defaultRadius) {
                      radius[side] = radius[side] || defaultRadius[side];
                    }
                  }
                  context.beginPath();
                  context.moveTo(x + radius.tl, y);
                  context.lineTo(x + width - radius.tr, y);
                  context.quadraticCurveTo(x + width, y, x + width, y + radius.tr);
                  context.lineTo(x + width, y + height - radius.br);
                  context.quadraticCurveTo(x + width, y + height, x + width - radius.br, y + height);
                  context.lineTo(x + radius.bl, y + height);
                  context.quadraticCurveTo(x, y + height, x, y + height - radius.bl);
                  context.lineTo(x, y + radius.tl);
                  context.quadraticCurveTo(x, y, x + radius.tl, y);
                  context.closePath();
                  if (fill) {
                    context.fill();
                  }
                  if (stroke) {
                    context.stroke();
                  }
                }

                background.onload = function() {
                    context.drawImage(background, 0, 0)
                };

                var maxWidth = 205;
                var lineHeight = 25;
                var x = (canvas.width - maxWidth) / 2;
                var y = 30;
                var text = "{{ invent(attempts, num_cards) }}";
                context.font = "bold 16px Helvetica";
                wrapText(context, text, x, y, maxWidth, lineHeight);
            </script>
        </canvas>
    </div>
</div>
{% endblock %}